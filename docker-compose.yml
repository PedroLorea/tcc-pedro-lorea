services:
  # ==========================
  # BANCO DO FRETE
  # ==========================
  postgres_frete:
    image: postgres:15-alpine
    container_name: postgres_frete
    restart: always
    environment:
      POSTGRES_USER: frete_user
      POSTGRES_PASSWORD: frete123
      POSTGRES_DB: frete_db
    ports:
      - "5432:5432"           
    volumes:
      - postgres_frete_data:/var/lib/postgresql/data

  # ==========================
  # BANCO DO PAGAMENTO
  # ==========================
  postgres_pagamento:
    image: postgres:15-alpine
    container_name: postgres_pagamento
    restart: always
    environment:
      POSTGRES_USER: pagamento_user
      POSTGRES_PASSWORD: pagamento123
      POSTGRES_DB: pagamento_db
    ports:
      - "5433:5432"           
    volumes:
      - postgres_pagamento_data:/var/lib/postgresql/data

  # ==========================
  # BANCO DA AUTENTICAÇÃO
  # ==========================
  postgres_autenticacao:
    image: postgres:15-alpine
    container_name: postgres_autenticacao
    restart: always
    environment:
      POSTGRES_USER: auth_user
      POSTGRES_PASSWORD: auth123
      POSTGRES_DB: auth_db
    ports:
      - "5434:5432"
    volumes:
      - postgres_autenticacao_data:/var/lib/postgresql/data

  # ==========================
  # BANCO DO RASTREAMENTO
  # ==========================
  postgres_rastreamento:
    image: postgres:15-alpine
    container_name: postgres_rastreamento
    restart: always
    environment:
      POSTGRES_USER: rastreamento_user
      POSTGRES_PASSWORD: rastreamento123
      POSTGRES_DB: rastreamento_db
    ports:
      - "5435:5432"
    volumes:
      - postgres_rastreamento_data:/var/lib/postgresql/data

  # ==========================
  # RABBITMQ
  # ==========================
  rabbitmq:
    image: rabbitmq:3-management
    container_name: rabbitmq
    ports:
      - "5672:5672"
      - "15672:15672"
    environment:
      RABBITMQ_DEFAULT_USER: guest
      RABBITMQ_DEFAULT_PASS: guest

  # ==========================
  # FRETE (Django)
  # ==========================
  frete:
    build: ./tcc-aplicacao/frete_service
    container_name: frete_service
    ports:
      - "8000:8000"
    environment:
      RABBITMQ_HOST: rabbitmq
      DATABASE_URL: postgres://frete_user:frete123@postgres_frete:5432/frete_db
    volumes:
      - ./tcc-aplicacao/frete_service:/app
    depends_on:
      - postgres_frete
      - rabbitmq

  # ==========================
  # PAGAMENTO (Django)
  # ==========================
  pagamento:
    build: ./tcc-aplicacao/pagamento_service
    container_name: pagamento_service
    ports:
      - "8001:8000"
    environment:
      RABBITMQ_HOST: rabbitmq
      DATABASE_URL: postgres://pagamento_user:pagamento123@postgres_pagamento:5432/pagamento_db
    volumes:
      - ./tcc-aplicacao/pagamento_service:/app
    depends_on:
      - postgres_pagamento
      - rabbitmq

  # ==========================
  # AUTENTICAÇÃO (Django)
  # ==========================
  autenticacao:
    build: ./tcc-aplicacao/autenticacao_service
    container_name: autenticacao_service
    ports:
      - "8003:8000"
    environment:
      RABBITMQ_HOST: rabbitmq
      DATABASE_URL: postgres://auth_user:auth123@postgres_autenticacao:5432/auth_db
    volumes:
      - ./tcc-aplicacao/autenticacao_service:/app
    depends_on:
      - postgres_autenticacao
      - rabbitmq

  # ==========================
  # RASTREAMENTO (Django)
  # ==========================
  rastreamento:
    build: ./tcc-aplicacao/rastreamento_service
    container_name: rastreamento_service
    ports:
      - "8005:8000"
    environment:
      RABBITMQ_HOST: rabbitmq
      DATABASE_URL: postgres://rastreamento_user:rastreamento123@postgres_rastreamento:5432/rastreamento_db
    volumes:
      - ./tcc-aplicacao/rastreamento_service:/app
    depends_on:
      - postgres_rastreamento
      - rabbitmq

  # ==========================
  # SUPORTE (Node.js)
  # ==========================
  suporte:
    build: ./tcc-aplicacao/suporte_service
    container_name: suporte_service
    ports:
      - "8002:8000"

  # ==========================
  # NOTIFICAÇÃO (WebSocket)
  # ==========================
  notificacao:
    build: ./tcc-aplicacao/notificacao_service
    container_name: notificacao_service
    ports:
      - "8004:8004"
    environment:
      RABBITMQ_HOST: rabbitmq
    volumes:
      - ./tcc-aplicacao/notificacao_service:/app
    depends_on:
      - rabbitmq

  # ==========================
  # FRONTEND (Next.js)
  # ==========================
  frontend:
    build: ./tcc-frontend
    container_name: tcc_frontend
    ports:
      - "3000:3000"
    environment:
      NEXT_PUBLIC_FRETE_SERVICE_URL: http://localhost:8000
      NEXT_PUBLIC_PAGAMENTO_SERVICE_URL: http://localhost:8001
      NEXT_PUBLIC_SUPORTE_SERVICE_URL: http://localhost:8002
      NEXT_PUBLIC_AUTENTICACAO_SERVICE_URL: http://localhost:8003
      NEXT_PUBLIC_NOTIFICACAO_SERVICE_URL: ws://localhost:8004
      NEXT_PUBLIC_RASTREAMENTO_SERVICE_URL: http://localhost:8005
    depends_on:
      - frete
      - pagamento
      - autenticacao
      - rastreamento
      - notificacao

# ==========================
# VOLUMES
# ==========================
volumes:
  postgres_frete_data:
  postgres_pagamento_data:
  postgres_autenticacao_data:
  postgres_rastreamento_data: